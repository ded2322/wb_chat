# Real-time chat
## Обзор проекта
Это Api создано для real-time чата, в рамках изучения работы web-socket.

Api Поддерживает: регистрацию пользователя, установку пользовательских аватарок, отправку сообщений. 
Детали в обновлениях.

Фронтенд: https://github.com/ded2322/frontend_chat

(Разработчик пожелал быть анонимным)

# Инструменты
Язык: Python 3.10

Фреймворк: FastApi

База данных: Postgres 16

Логи: Grafana + Prometheus

# Обновления
### v 1.5 [Текущая]
- Уменьшен размер допустимых аватарок до 1 мб.
- Добавлена валидация при отправки данных при подключению к сокету.

Версия готовая для запуска в прод, подключены:
- Prometheus + Grafana
- Nginx
### v 1.4
- Загрузка аватара пользователя стала фоновой 
- Добавлено 14 новых аватарок по умолчанию 
- Добавлена дополнительная валидация в вебсокете,
при неправильных данных происходит отключение от сокета
- Рефакторинг и оптимизация кода, улучшен нейминг переменных отдаваемых клиенту

### v 1.3
- Изменен алгоритм шифрования паролей
- Изменен алгоритм удаления пользователя
- Добавлена возможность удалять и редактировать сообщения
- Созданы роли пользователей
Доступно 3 вида ролей
  1. Пользователь
  2. Модератор
  3. Администратор

Обновление endpoint: 
- Созданы 2 endpoint, для регистрации обычного пользователя и админа.
При создании регистрации дополнительно нужно указывать роль.
- Созданы 2 endpoint для обновления и удаления сообщений.

    Для обновлений сообщения нужно передать токен и id сообщение и новое сообщение. 

    Обновлять сообщение может только тот, кто его создал.

    Для удаления сообщения нужно токен и id сообщение. 
    Удалять сообщение иметь права пользователи только 2 или 3 ролью.
 
#### v 1.2 

- Добавлены логи в код, созданы файлы для отслеживания логов
- Подключен Grafana в связке с prometheus,
доступ к Grafana: http://localhost:3000
- Добавлена Админ.панель. Логин и пароль admin,
доступ к Админ.панели http://localhost:8000/admin/login
- Улучшен алгоритм сжатия изображений.
- Изменен алгоритм удаления пользователя.
- Добавлена подгрузка дополнительных 50 сообщений.

Обновление endpoint: 
- Добавлен endpoint /chat/load, позволяет подгружать дополнительные сообщения.
В теле принимает id сообщения, с которого должны загружаться изображения.
- Обновлен endpoint, отвечающий за загрузку 50 последних сообщений.
Добавлены поля: id пользователя, id сообщения. 
Изменено отображение сообщений, сообщения идут на убывания.
- Изменен алгоритм удаление аккаунта.

#### v 1.1 

- Добавил возможность пользователям ставить свои фото профиля.
- При создании аккаунта, ставится случайное фото профиля на основе изображений по умолчанию.  
- Удаление аккаунта пользователя.
- Отображение последних 50 сообщений.
- При отправке сообщений, помимо сообщения, ника передается: Время отправки, аватар.

Обновление endpoint: 
- При регистрации пользователя случайным образом присваивается изображение из изображений по умолчанию. 
Путь до [изображений](core%2Fstatic%2Fimage_default).
- При входе в аккаунт возвращается токен.
- Для обновления и удаления аккаунта пользователя, необходимо передавать токен.
- Новый endpoint позволяющий загружать аватарки. 
Принимает файлы с расширением .png, .jpg, .webp. 

#### v 0.1

- Создание пользователя и jwt токена
- Отправка сообщений по websocket 

# Как запустить
### С Docker-compose
1. Перейти в директорию с файлом
```commandline
cd wb_chat
``` 
2. Собрать Docker-compose образ
```commandline
docker-compose build
```
3. Запустить Docker-compose образ
```commandline
docker-compose up
```

# Это должен помнить каждый
Чтобы подключиться к вебсокету используется адрес: ws://localhost:8000/ws.

Он ВСЕ отдает в виде json и принимает только json.